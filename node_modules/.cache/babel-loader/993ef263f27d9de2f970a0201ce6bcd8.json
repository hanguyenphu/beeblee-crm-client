{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\Ha Nguyen\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\react-scripts\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"C:\\\\Users\\\\Ha Nguyen\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\react-scripts\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\Ha Nguyen\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\react-scripts\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"C:\\\\Users\\\\Ha Nguyen\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\react-scripts\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"C:\\\\Users\\\\Ha Nguyen\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\react-scripts\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _inherits from\"C:\\\\Users\\\\Ha Nguyen\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\react-scripts\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React,{Component}from\"react\";import{connect}from\"react-redux\";import{Col,Row,Table,TextInput,Select,Icon,Button,Pagination}from\"react-materialize\";import Loading from\"../loading/Loading\";import axios from\"axios\";import{fetch_province,fetch_business}from\"../../redux/actions/index\";import BusinessModalDetail from\"./BusinessModalDetail\";import API from\"../../utils/API/API\";import formatPhone from\"../../utils/commons/FormatPhone\";import CreateBusinessModal from\"./CreateBusinessModal\";import{Link}from\"react-router-dom\";var mapStateToProps=function mapStateToProps(state){return{provinces:state.provinces};};function mapDispatchToProps(dispatch){return{addProvinceToRedux:function addProvinceToRedux(provinces){return dispatch(fetch_province(provinces));},addBusinessesToRedux:function addBusinessesToRedux(businesses){return dispatch(fetch_business(businesses));}};}var Business=/*#__PURE__*/function(_Component){_inherits(Business,_Component);function Business(props){var _this;_classCallCheck(this,Business);_this=_possibleConstructorReturn(this,_getPrototypeOf(Business).call(this,props));_this.getDataForPagination=function(pageNumber){API.get(\"businesses?pageNo=\".concat(pageNumber)).then(function(response){_this.setState(_objectSpread({},_this.state,{businesses:response.data.businesses,businessCount:response.data.count}));}).catch(function(error){console.log(error);});};_this.getData=function(){var getProvinceRequest=API.get(\"provinces\");var getBusinessRequest=API.get(\"businesses?pageNo=1\");//This API get all businesses and add to redux\n// API(`/search/businesses`)\n//   .then(response => {\n//     this.props.addBusinessesToRedux(response.data);\n//   })\n//   .catch(error => {\n//     console.log(error);\n//   });\n//APT get all businesses with page Number and provinces\naxios.all([getProvinceRequest,getBusinessRequest]).then(axios.spread(function(){for(var _len=arguments.length,responses=new Array(_len),_key=0;_key<_len;_key++){responses[_key]=arguments[_key];}var provinces=responses[0].data;var businesses=responses[1].data.businesses;var businessCount=responses[1].data.count;_this.setState({provinces:provinces,businesses:businesses,businessCount:businessCount,loading:false});//Save data in redux for later usage\n_this.props.addProvinceToRedux(provinces);})).catch(function(error){console.log(error);});};_this.handleSubmit=function(e){e.preventDefault();};_this.handleInputChange=function(e){var searchBy=_objectSpread({},_this.state.searchBy);var field=e.target.name;var value=e.target.value;if(field===\"phone\"){value=formatPhone(value);}searchBy[field]=value;_this.setState(_objectSpread({},_this.state,{searchBy:searchBy}));};_this.getProvinceName=function(_id){var provinces=_this.state.provinces;var foundProvince=provinces.filter(function(province){return province._id===_id;});return foundProvince[0].name;};_this.handleOpenModal=function(business){return function(){_this.setState({business:business});};};_this.handleFilter=function(e){e.preventDefault();var businesses=[];API.get(\"/search/businesses\").then(function(response){businesses=response.data;var fields=Object.keys(_this.state.searchBy);fields.forEach(function(field){businesses=_this.filterByField(_this.state.searchBy[field],field,businesses);});_this.setState(_objectSpread({},_this.state,{search:true,results:businesses}));}).catch(function(error){console.log(error);});};_this.handleResetFilter=function(e){e.preventDefault();_this.setState(_objectSpread({},_this.state,{searchBy:{name:\"\",phone:\"\",province:\"\"},search:false}));};_this.handleCreateModel=function(){_this.setState(_objectSpread({},_this.state,{openCreateModal:true}));};_this.closeCreateModal=function(){_this.setState({openCreateModal:false});};_this.state={searchBy:{name:\"\",phone:\"\",province:\"\"},provinces:[],loading:true,search:false,openCreateModal:false,currentPage:1};return _this;}_createClass(Business,[{key:\"componentDidMount\",value:function componentDidMount(){this.getData();}},{key:\"filterByField\",value:function filterByField(searchText,field,array){var results=array.filter(function(item){return item[field].replace(/\\s/g,\"\").toLowerCase().includes(searchText.replace(/\\s/g,\"\").toLowerCase());});return results;}},{key:\"render\",value:function render(){var _this2=this;var _this$state$searchBy=this.state.searchBy,name=_this$state$searchBy.name,phone=_this$state$searchBy.phone,province=_this$state$searchBy.province;var _this$state=this.state,loading=_this$state.loading,provinces=_this$state.provinces,business=_this$state.business,search=_this$state.search,openCreateModal=_this$state.openCreateModal,businessCount=_this$state.businessCount,currentPage=_this$state.currentPage;if(loading){return React.createElement(Loading,null);}//Get the set of search otherwise display all businesses\nvar businesses=search?this.state.results:this.state.businesses;return React.createElement(\"div\",null,React.createElement(Row,{style:{marginTop:\"20px\"}}),React.createElement(Row,null,React.createElement(Col,null,React.createElement(\"h5\",null,\"Businesses\",\" \",React.createElement(Button,{node:\"button\",type:\"submit\",waves:\"light\",className:\"gradient-btn btn-red\",onClick:this.handleCreateModel},\"Add\",React.createElement(Icon,{left:true},\"add_box\"))))),React.createElement(Row,{className:\" radius-corner\",style:{backgroundColor:\"white\",padding:\"20px\",boxShadow:\"1px 1px 1px #9E9E9E\"}},React.createElement(\"form\",null,React.createElement(\"h6\",null,\"Filter by\"),React.createElement(Col,{s:12,m:12,l:12,xl:12},React.createElement(TextInput,{s:12,l:4,m:4,xl:4,label:\"Name\",name:\"name\",value:name,onChange:this.handleInputChange}),React.createElement(TextInput,{s:12,l:3,m:3,xl:3,label:\"Phone\",name:\"phone\",value:phone,onChange:this.handleInputChange}),React.createElement(Select,{onChange:this.handleInputChange,options:{classes:\"\",dropdownOptions:{alignment:\"left\",autoTrigger:true,closeOnClick:true,constrainWidth:true,container:null,coverTrigger:true,hover:false,inDuration:150,onCloseEnd:null,onCloseStart:null,onOpenEnd:null,onOpenStart:null,outDuration:250}},value:province,name:\"province\"},React.createElement(\"option\",{disabled:true,value:\"\"},\"Select Province\"),provinces.map(function(province){return React.createElement(\"option\",{className:\"black-text\",key:province._id,value:province._id},province.name);})),React.createElement(Button,{className:\"gradient-btn btn-primary\",node:\"button\",onClick:this.handleFilter,style:{marginRight:\"5px\",bottom:\"-20px\",marginBottom:\"20px\"},waves:\"light\"},\"Search\"),React.createElement(Button,{node:\"button\",className:\"gradient-btn btn-white\",onClick:this.handleResetFilter,style:{marginRight:\"5px\",bottom:\"-20px\",marginBottom:\"20px\"},waves:\"light\"},\"Reset\")))),React.createElement(Row,{className:\"animated fadeIn radius-corner\",style:{backgroundColor:\"white\",padding:\"20px\",boxShadow:\"1px 1px 1px #9E9E9E\"}},React.createElement(Col,{s:12,m:12,l:12,xl:12,style:{marginTop:\"50px\"}},React.createElement(Row,{style:{textAlign:\"center\"}},React.createElement(Pagination,{activePage:currentPage,items:businessCount/5+1,leftBtn:React.createElement(Icon,null,\"chevron_left\"),maxButtons:3,rightBtn:React.createElement(Icon,null,\"chevron_right\"),onSelect:function onSelect(pageNumber){_this2.getDataForPagination(pageNumber);}})),React.createElement(Table,{striped:true,responsive:true},React.createElement(\"thead\",null,React.createElement(\"tr\",null,React.createElement(\"th\",{\"data-field\":\"id\"},\"Name\"),React.createElement(\"th\",{\"data-field\":\"price\"},\"Phone\"),React.createElement(\"th\",{\"data-field\":\"price\"},\"Province\"),React.createElement(\"th\",{\"data-field\":\"price\"},\"Quick View\"))),React.createElement(\"tbody\",null,businesses.length>0?businesses.map(function(business){return React.createElement(\"tr\",{key:business._id},React.createElement(\"td\",null,React.createElement(Link,{to:\"/businesses/\"+business._id},business.name)),React.createElement(\"td\",null,business.phone),React.createElement(\"td\",null,_this2.getProvinceName(business.province)),React.createElement(\"td\",null,React.createElement(\"a\",{onClick:_this2.handleOpenModal(business),className:\"modal-trigger\",href:\"#modal1\"},React.createElement(Icon,null,\"launch\"))));}):React.createElement(\"tr\",null,React.createElement(\"td\",null,\"There is no business found!\")))))),React.createElement(\"div\",null,business&&React.createElement(BusinessModalDetail,{business:business,updateData:this.getData})),React.createElement(\"div\",null,openCreateModal&&React.createElement(CreateBusinessModal,{closeCreateModal:this.closeCreateModal,updateData:this.getData})));}}]);return Business;}(Component);export default connect(mapStateToProps,mapDispatchToProps)(Business);","map":{"version":3,"sources":["C:/xampp/htdocs/beeblee-crm-client/src/features/business/Business.jsx"],"names":["React","Component","connect","Col","Row","Table","TextInput","Select","Icon","Button","Pagination","Loading","axios","fetch_province","fetch_business","BusinessModalDetail","API","formatPhone","CreateBusinessModal","Link","mapStateToProps","state","provinces","mapDispatchToProps","dispatch","addProvinceToRedux","addBusinessesToRedux","businesses","Business","props","getDataForPagination","pageNumber","get","then","response","setState","data","businessCount","count","catch","error","console","log","getData","getProvinceRequest","getBusinessRequest","all","spread","responses","loading","handleSubmit","e","preventDefault","handleInputChange","searchBy","field","target","name","value","getProvinceName","_id","foundProvince","filter","province","handleOpenModal","business","handleFilter","fields","Object","keys","forEach","filterByField","search","results","handleResetFilter","phone","handleCreateModel","openCreateModal","closeCreateModal","currentPage","searchText","array","item","replace","toLowerCase","includes","marginTop","backgroundColor","padding","boxShadow","classes","dropdownOptions","alignment","autoTrigger","closeOnClick","constrainWidth","container","coverTrigger","hover","inDuration","onCloseEnd","onCloseStart","onOpenEnd","onOpenStart","outDuration","map","marginRight","bottom","marginBottom","textAlign","length"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport {\r\n  Col,\r\n  Row,\r\n  Table,\r\n  TextInput,\r\n  Select,\r\n  Icon,\r\n  Button,\r\n  Pagination\r\n} from \"react-materialize\";\r\nimport Loading from \"../loading/Loading\";\r\nimport axios from \"axios\";\r\nimport { fetch_province, fetch_business } from \"../../redux/actions/index\";\r\nimport BusinessModalDetail from \"./BusinessModalDetail\";\r\nimport API from \"../../utils/API/API\";\r\nimport formatPhone from \"../../utils/commons/FormatPhone\";\r\nimport CreateBusinessModal from \"./CreateBusinessModal\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nconst mapStateToProps = state => {\r\n  return { provinces: state.provinces };\r\n};\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    addProvinceToRedux: provinces => dispatch(fetch_province(provinces)),\r\n    addBusinessesToRedux: businesses => dispatch(fetch_business(businesses))\r\n  };\r\n}\r\n\r\nclass Business extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      searchBy: {\r\n        name: \"\",\r\n        phone: \"\",\r\n        province: \"\"\r\n      },\r\n      provinces: [],\r\n      loading: true,\r\n      search: false,\r\n      openCreateModal: false,\r\n      currentPage: 1\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.getData();\r\n  }\r\n\r\n  filterByField(searchText, field, array) {\r\n    let results = array.filter(item =>\r\n      item[field]\r\n        .replace(/\\s/g, \"\")\r\n        .toLowerCase()\r\n        .includes(searchText.replace(/\\s/g, \"\").toLowerCase())\r\n    );\r\n    return results;\r\n  }\r\n\r\n  getDataForPagination = pageNumber => {\r\n    API.get(`businesses?pageNo=${pageNumber}`)\r\n      .then(response => {\r\n        this.setState({\r\n          ...this.state,\r\n          businesses: response.data.businesses,\r\n          businessCount: response.data.count\r\n        });\r\n      })\r\n      .catch(error => {\r\n        console.log(error);\r\n      });\r\n  };\r\n\r\n  getData = () => {\r\n    const getProvinceRequest = API.get(\"provinces\");\r\n    const getBusinessRequest = API.get(\"businesses?pageNo=1\");\r\n\r\n    //This API get all businesses and add to redux\r\n    // API(`/search/businesses`)\r\n    //   .then(response => {\r\n    //     this.props.addBusinessesToRedux(response.data);\r\n    //   })\r\n    //   .catch(error => {\r\n    //     console.log(error);\r\n    //   });\r\n\r\n    //APT get all businesses with page Number and provinces\r\n    axios\r\n      .all([getProvinceRequest, getBusinessRequest])\r\n      .then(\r\n        axios.spread((...responses) => {\r\n          const provinces = responses[0].data;\r\n          const businesses = responses[1].data.businesses;\r\n          const businessCount = responses[1].data.count;\r\n\r\n          this.setState({\r\n            provinces,\r\n            businesses,\r\n            businessCount,\r\n            loading: false\r\n          });\r\n          //Save data in redux for later usage\r\n          this.props.addProvinceToRedux(provinces);\r\n        })\r\n      )\r\n      .catch(error => {\r\n        console.log(error);\r\n      });\r\n  };\r\n\r\n  handleSubmit = e => {\r\n    e.preventDefault();\r\n  };\r\n\r\n  handleInputChange = e => {\r\n    const searchBy = { ...this.state.searchBy };\r\n    const field = e.target.name;\r\n    let value = e.target.value;\r\n    if (field === \"phone\") {\r\n      value = formatPhone(value);\r\n    }\r\n    searchBy[field] = value;\r\n\r\n    this.setState({\r\n      ...this.state,\r\n      searchBy\r\n    });\r\n  };\r\n\r\n  getProvinceName = _id => {\r\n    const { provinces } = this.state;\r\n    const foundProvince = provinces.filter(province => province._id === _id);\r\n    return foundProvince[0].name;\r\n  };\r\n\r\n  handleOpenModal = business => () => {\r\n    this.setState({\r\n      business\r\n    });\r\n  };\r\n\r\n  //Client side search only\r\n  //this function get all businesses from server by calling api /search/businesses\r\n  //then filter the options on Client side\r\n  handleFilter = e => {\r\n    e.preventDefault();\r\n    let businesses = [];\r\n    API.get(\"/search/businesses\")\r\n      .then(response => {\r\n        businesses = response.data;\r\n\r\n        const fields = Object.keys(this.state.searchBy);\r\n        fields.forEach(field => {\r\n          businesses = this.filterByField(\r\n            this.state.searchBy[field],\r\n            field,\r\n            businesses\r\n          );\r\n        });\r\n\r\n        this.setState({\r\n          ...this.state,\r\n          search: true,\r\n          results: businesses\r\n        });\r\n      })\r\n      .catch(error => {\r\n        console.log(error);\r\n      });\r\n  };\r\n\r\n  handleResetFilter = e => {\r\n    e.preventDefault();\r\n    this.setState({\r\n      ...this.state,\r\n      searchBy: {\r\n        name: \"\",\r\n        phone: \"\",\r\n        province: \"\"\r\n      },\r\n      search: false\r\n    });\r\n  };\r\n\r\n  handleCreateModel = () => {\r\n    this.setState({\r\n      ...this.state,\r\n      openCreateModal: true\r\n    });\r\n  };\r\n\r\n  closeCreateModal = () => {\r\n    this.setState({\r\n      openCreateModal: false\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const { name, phone, province } = this.state.searchBy;\r\n    const {\r\n      loading,\r\n      provinces,\r\n      business,\r\n      search,\r\n      openCreateModal,\r\n      businessCount,\r\n      currentPage\r\n    } = this.state;\r\n\r\n    if (loading) {\r\n      return <Loading />;\r\n    }\r\n\r\n    //Get the set of search otherwise display all businesses\r\n    let businesses = search ? this.state.results : this.state.businesses;\r\n\r\n    return (\r\n      <div>\r\n        <Row style={{ marginTop: \"20px\" }}></Row>\r\n        <Row>\r\n          <Col>\r\n            <h5>\r\n              Businesses{\" \"}\r\n              <Button\r\n                node=\"button\"\r\n                type=\"submit\"\r\n                waves=\"light\"\r\n                className=\"gradient-btn btn-red\"\r\n                onClick={this.handleCreateModel}\r\n              >\r\n                Add\r\n                <Icon left>add_box</Icon>\r\n              </Button>\r\n            </h5>\r\n          </Col>\r\n        </Row>\r\n        <Row\r\n          className=\" radius-corner\"\r\n          style={{\r\n            backgroundColor: \"white\",\r\n            padding: \"20px\",\r\n            boxShadow: \"1px 1px 1px #9E9E9E\"\r\n          }}\r\n        >\r\n          <form>\r\n            <h6>Filter by</h6>\r\n            <Col s={12} m={12} l={12} xl={12}>\r\n              <TextInput\r\n                s={12}\r\n                l={4}\r\n                m={4}\r\n                xl={4}\r\n                label=\"Name\"\r\n                name=\"name\"\r\n                value={name}\r\n                onChange={this.handleInputChange}\r\n              />\r\n\r\n              <TextInput\r\n                s={12}\r\n                l={3}\r\n                m={3}\r\n                xl={3}\r\n                label=\"Phone\"\r\n                name=\"phone\"\r\n                value={phone}\r\n                onChange={this.handleInputChange}\r\n              />\r\n\r\n              <Select\r\n                onChange={this.handleInputChange}\r\n                options={{\r\n                  classes: \"\",\r\n                  dropdownOptions: {\r\n                    alignment: \"left\",\r\n                    autoTrigger: true,\r\n                    closeOnClick: true,\r\n                    constrainWidth: true,\r\n                    container: null,\r\n                    coverTrigger: true,\r\n                    hover: false,\r\n                    inDuration: 150,\r\n                    onCloseEnd: null,\r\n                    onCloseStart: null,\r\n                    onOpenEnd: null,\r\n                    onOpenStart: null,\r\n                    outDuration: 250\r\n                  }\r\n                }}\r\n                value={province}\r\n                name=\"province\"\r\n              >\r\n                <option disabled value=\"\">\r\n                  Select Province\r\n                </option>\r\n                {provinces.map(province => {\r\n                  return (\r\n                    <option\r\n                      className=\"black-text\"\r\n                      key={province._id}\r\n                      value={province._id}\r\n                    >\r\n                      {province.name}\r\n                    </option>\r\n                  );\r\n                })}\r\n              </Select>\r\n              <Button\r\n                className=\"gradient-btn btn-primary\"\r\n                node=\"button\"\r\n                onClick={this.handleFilter}\r\n                style={{\r\n                  marginRight: \"5px\",\r\n                  bottom: \"-20px\",\r\n                  marginBottom: \"20px\"\r\n                }}\r\n                waves=\"light\"\r\n              >\r\n                Search\r\n              </Button>\r\n              <Button\r\n                node=\"button\"\r\n                className=\"gradient-btn btn-white\"\r\n                onClick={this.handleResetFilter}\r\n                style={{\r\n                  marginRight: \"5px\",\r\n                  bottom: \"-20px\",\r\n                  marginBottom: \"20px\"\r\n                }}\r\n                waves=\"light\"\r\n              >\r\n                Reset\r\n              </Button>\r\n            </Col>\r\n          </form>\r\n        </Row>\r\n        <Row\r\n          className=\"animated fadeIn radius-corner\"\r\n          style={{\r\n            backgroundColor: \"white\",\r\n            padding: \"20px\",\r\n            boxShadow: \"1px 1px 1px #9E9E9E\"\r\n          }}\r\n        >\r\n          <Col s={12} m={12} l={12} xl={12} style={{ marginTop: \"50px\" }}>\r\n            <Row style={{ textAlign: \"center\" }}>\r\n              <Pagination\r\n                activePage={currentPage}\r\n                items={businessCount / 5 + 1}\r\n                leftBtn={<Icon>chevron_left</Icon>}\r\n                maxButtons={3}\r\n                rightBtn={<Icon>chevron_right</Icon>}\r\n                onSelect={pageNumber => {\r\n                  this.getDataForPagination(pageNumber);\r\n                }}\r\n              />\r\n            </Row>\r\n            <Table striped={true} responsive={true}>\r\n              <thead>\r\n                <tr>\r\n                  <th data-field=\"id\">Name</th>\r\n                  <th data-field=\"price\">Phone</th>\r\n                  <th data-field=\"price\">Province</th>\r\n                  <th data-field=\"price\">Quick View</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {businesses.length > 0 ? (\r\n                  businesses.map(business => {\r\n                    return (\r\n                      <tr key={business._id}>\r\n                        <td>\r\n                          <Link to={\"/businesses/\" + business._id}>\r\n                            {business.name}\r\n                          </Link>\r\n                        </td>\r\n                        <td>{business.phone}</td>\r\n                        <td>{this.getProvinceName(business.province)}</td>\r\n                        <td>\r\n                          <a\r\n                            onClick={this.handleOpenModal(business)}\r\n                            className=\"modal-trigger\"\r\n                            href=\"#modal1\"\r\n                          >\r\n                            <Icon>launch</Icon>\r\n                          </a>\r\n                        </td>\r\n                      </tr>\r\n                    );\r\n                  })\r\n                ) : (\r\n                  <tr>\r\n                    <td>There is no business found!</td>\r\n                  </tr>\r\n                )}\r\n              </tbody>\r\n            </Table>\r\n          </Col>\r\n        </Row>\r\n\r\n        <div>\r\n          {business && (\r\n            <BusinessModalDetail\r\n              business={business}\r\n              updateData={this.getData}\r\n            />\r\n          )}\r\n        </div>\r\n\r\n        <div>\r\n          {openCreateModal && (\r\n            <CreateBusinessModal\r\n              closeCreateModal={this.closeCreateModal}\r\n              updateData={this.getData}\r\n            />\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Business);\r\n"]},"metadata":{},"sourceType":"module"}